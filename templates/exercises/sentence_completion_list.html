{% extends "base.html" %}
{% load static %}

{% block title %}{{ page_title }} - Sami-Sa{% endblock %}

{% block content %}
{% csrf_token %}
<!-- Header -->
<header class="bg-gradient-to-r from-pink-600 to-rose-500 text-white shadow-lg rounded-2xl">
    <div class="container mx-auto px-4 py-8">
        <a href="{% url 'exercises:exercise_dashboard' %}" class="text-pink-200 hover:text-white transition inline-flex items-center gap-2 mb-4">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            Sp√§≈• na cviƒçenia
        </a>
        <div class="flex items-center gap-4">
            <span class="text-5xl">‚úèÔ∏è</span>
            <div>
                <h1 class="text-3xl font-bold">{{ page_title }}</h1>
                <p class="mt-1 text-pink-100">{{ overview }}</p>
            </div>
        </div>
    </div>
</header>

<div class="container mx-auto px-4 py-8">
    <!-- Filter by lesson type -->
    <div class="mb-8 flex flex-wrap gap-3">
        <a href="{% url 'exercises:sentence_completion_list' %}" 
           class="px-4 py-2 rounded-full text-sm font-medium {% if not request.GET.lesson_type %}bg-pink-600 text-white{% else %}bg-gray-200 text-gray-700 hover:bg-gray-300{% endif %} transition">
            V≈°etky
        </a>
        {% for lt, label in lesson_types %}
        <a href="?lesson_type={{ lt }}" 
           class="px-4 py-2 rounded-full text-sm font-medium {% if request.GET.lesson_type == lt %}bg-pink-600 text-white{% else %}bg-gray-200 text-gray-700 hover:bg-gray-300{% endif %} transition">
            {{ label }}
        </a>
        {% endfor %}
    </div>

    <!-- Instructions -->
    <div class="bg-pink-50 border border-pink-200 rounded-xl p-4 mb-8">
        <p class="text-pink-800">
            <strong>üí° N√°vod:</strong> Dopl≈àte ch√Ωbaj√∫ce anglick√© slovo do vety.
        </p>
    </div>

    <!-- Exercises -->
    <div class="space-y-6">
        {% for completion in completions %}
        <div class="bg-white rounded-xl shadow-md p-6 border border-gray-100 completion-card"
             data-correct="{{ completion.sentence|lower }}"
             data-completion-id="{{ completion.id }}">
            
            <!-- Title -->
            <h2 class="text-xl font-bold text-pink-600 mb-2">{{ completion.exercise.title }}</h2>
            
            <!-- Sentence -->
            <div class="bg-gray-50 p-4 rounded-lg mb-4 border-l-4 border-pink-400">
                <p class="text-lg text-gray-800">
                    {{ completion.correct_answer }}
                    <input type="text" 
                           class="completion-input px-3 py-2 border-b-4 border-pink-400 bg-white text-center font-medium focus:outline-none transition ml-2"
                           placeholder="..."
                           autocomplete="off"
                           style="width: 100px;">
                </p>
            </div>
            
               
            <!-- Buttons -->
            <div class="flex gap-2 mb-4">
                <button onclick="checkCompletion(this)" class="px-4 py-2 bg-pink-600 text-white rounded hover:bg-pink-700 font-medium check-btn">
                    ‚úì Skontrolova≈•
                </button>
                <button onclick="showAnswer(this)" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">
                    üí° Uk√°za≈•
                </button>
                <button onclick="resetForm(this)" class="px-4 py-2 bg-gray-300 text-gray-700 rounded hover:bg-gray-400">
                    üîÑ Znova
                </button>
            </div>
            
            <!-- Feedback -->
            <div class="feedback-area hidden p-4 rounded text-center font-bold"></div>
        </div>
        {% empty %}
        <p class="text-center text-gray-600 py-8">≈Ωiadne cviƒçenia</p>
        {% endfor %}
    </div>
</div>

<script>
function checkCompletion(button) {
    const card = button.closest('.completion-card');
    const correct = card.dataset.correct;
    const input = card.querySelector('.completion-input');
    const feedback = card.querySelector('.feedback-area');
    
    const answer = input.value.trim().toLowerCase();
    
    feedback.classList.remove('hidden', 'bg-green-100', 'bg-red-100', 'text-green-800', 'text-red-800');
    
    if (!answer) {
        feedback.classList.add('bg-yellow-100', 'text-yellow-800');
        feedback.textContent = '‚ö†Ô∏è Nap√≠≈°te odpoveƒè';
        return;
    }
    
    if (answer === correct) {
        feedback.classList.add('bg-green-100', 'text-green-800');
        feedback.textContent = '‚úÖ Spr√°vne! V√Ωborne!';
        input.disabled = true;
        button.disabled = true;
    } else {
        feedback.classList.add('bg-red-100', 'text-red-800');
        feedback.textContent = '‚ùå Zle. Sk√∫ste znova.';
        input.value = '';
    }
}

function showAnswer(button) {
    const card = button.closest('.completion-card');
    const input = card.querySelector('.completion-input');
    const correct = card.dataset.correct;
    input.value = correct;
}

function resetForm(button) {
    const card = button.closest('.completion-card');
    const input = card.querySelector('.completion-input');
    const feedback = card.querySelector('.feedback-area');
    const checkBtn = card.querySelector('.check-btn');
    
    input.value = '';
    input.disabled = false;
    feedback.classList.add('hidden');
    checkBtn.disabled = false;
    input.focus();
}

// Enter key submits
document.querySelectorAll('.completion-input').forEach(input => {
    input.addEventListener('keypress', e => {
        if (e.key === 'Enter') {
            input.closest('.completion-card').querySelector('.check-btn').click();
        }
    });
});
</script>
{% endblock %}